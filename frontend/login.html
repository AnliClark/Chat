<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - Let's Chat!</title>
    <link rel="stylesheet" type="text/css" href="style.css">
</head>
<body>
    <div class="login-container">
        <h2>Login to Let's Chat!</h2>
        <input type="text" id="username" placeholder="Enter your username" required>
        <button id="loginButton">Login</button>
    </div>
    <script >
        // 客户端发给服务端的消息：
        // request={
        //      "type":"login", 
        //      "username": string 
        // }
        //服务端返回的响应消息为：
        // response={
        //      "type": "login_response",
        //      "success": bool
        //      "username": username
        // }
        const ws = new WebSocket('ws://127.0.0.1:3030/login');
        ws.onopen = function() {
            console.log('Connected to WebSocket');
        };
        ws.onmessage = function(event){
            console.log('收到消息')  // todo: debug
            const data = JSON.parse(event.data);  // data中有success(bool)和username(string)
            if (data.success) {
                    localStorage.setItem('username', data.username);   // 设置用户名
                    // // // 每更新登录一个用户，都要更新用户列表 todo(改为服务端在新用户上线时自动更新)
                    // ws.send(JSON.stringify({ 
                    //     "type": 'update_users'}));
                    window.location.href = 'wechat.html';  // todo
                } else {
                    alert('Username already taken. Please choose another one.');
                }
        };
        // 登录部分
        document.getElementById('loginButton').addEventListener('click', () => {
            const username = document.getElementById('username').value;
            ws.send(JSON.stringify({ "type":"login", "username": username }));
        });

        
    </script>
</body>
</html>
